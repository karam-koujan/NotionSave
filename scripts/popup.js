(()=>{"use strict";const e=function(e,t,n){const o=document.createElement(e);if(null!==t)for(let e in t)o.setAttribute(e,t[e]);if(void 0!==n)return Array.isArray(n)?n.forEach((e=>{o.appendChild(e)})):"string"==typeof n?o.textContent=n:o.appendChild(n),o},t="https://notionsave.onrender.com",n=function(){const e=document.getElementById("createDbBtn");e.textContent="Creating...";const n=JSON.parse(localStorage.getItem("user"));fetch(`${t}/api/createDB`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n.access_token}}).then((t=>(e.textContent="Database is created!!",t.json()))).then((({data:e})=>{console.log("data",e),localStorage.setItem("databaseId",e.id),chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{databaseId:e.id})}))}))},o=function(){document.getElementById("login").textContent="Connecting...",chrome.identity.launchWebAuthFlow({url:"https://api.notion.com/v1/oauth/authorize?client_id=886c4ba1-a766-4abe-b227-68d823f578eb&response_type=code&owner=user&redirect_uri=https%3A%2F%2Flgfogmkjmheekcelnijmlmbojdbaoabh.chromiumapp.org%2F",interactive:!0},(function(e){if(chrome.runtime.lastError||!e)return void console.error(chrome.runtime.lastError);console.log(e);const t=function(e){const t=new URL(e);return{code:t.searchParams.get("code"),error:t.searchParams.get("error")}}(e);console.log("dd"),t.code,localStorage.setItem("redirectUrlCode",JSON.stringify(t))}));const e=JSON.parse(localStorage.getItem("user"));e&&setTimeout((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{accessToken:e.access_token})}))}),500)},a=function({owner:t}){const n=document.getElementById("profile"),o=function(t){const n=e("img",{style:"object-fit:cover;border-radius:50%;width:100%;display:block;",src:t.img,alt:t.name},"");return e("div",{style:"border-radius:50%; margin-inline:auto; width:100px; margin-top:1rem;"},n)}({img:t.user.avatar_url,alt:t.user.name}),a=(r={name:t.user.name},e("p",{style:"color:#37352f;font-size:17px;text-align:center;font-weight:bold;margin-top:.5rem;"},r.name));var r;return n.appendChild(o),n.appendChild(a),n};window.onload=()=>{const e=document.getElementById("createDbBtn"),n=JSON.parse(localStorage.getItem("user"));if(console.log("user",n),null!==n){fetch(`${t}/api/dbId`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:n.access_token}}).then((e=>e.json())).then((t=>{t.error||0===t.dbId.length?e.textContent="Create Notion Database":(localStorage.setItem("databaseId",t.dbId[0]),e.textContent="database is created",e.style.opacity="0.8",e.disabled=!0)}));const o=localStorage.getItem("databaseId");setTimeout((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{accessToken:n.access_token})}))}),500),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{accessToken:n.access_token})})),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{databaseId:o})}))}},document.addEventListener("DOMContentLoaded",(()=>{!function(){const t=e("btn",{class:"createDb",id:"createDbBtn"},"loading"),o=document.getElementById("createDb");t.addEventListener("click",n),o.appendChild(t)}();const r=document.getElementById("createDbBtn"),c=JSON.parse(localStorage.getItem("redirectUrlCode"));let s="undefined"!==localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):void 0;if(!s&&c){console.log("dom",s);const e=`${t}/api/auth?code=${c.code}&error=${c.error}`;fetch(e).then((e=>e.json())).then((e=>{if(e.error)return;chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{accessToken:e.data.access_token})})),fetch(`${t}/api/dbId`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:e.data.access_token}}).then((e=>e.json())).then((e=>{e.error||0===e.dbId.length?r.textContent="Create Notion Database":(chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{databaseId:e.dbId[0]})})),r.textContent="database is created",r.style.opacity="0.8",r.disabled=!0)}));const n=document.getElementById("login");return localStorage.setItem("user",JSON.stringify(e.data)),a(e.data),n&&(n.style.display="none"),r.style.display="block",e.error?console.log("error"):void 0}))}s="undefined"!==localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):void 0,s?a(s):(function(){const t=e("button",{id:"login",class:"createDb"},"Connect to notion"),n=document.getElementById("connect");t.addEventListener("click",o),n.appendChild(t)}(),r.style.display="none")}))})();