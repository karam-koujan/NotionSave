(()=>{"use strict";const e=function(e,t,o){const n=document.createElement(e);if(null!==t)for(let e in t)n.setAttribute(e,t[e]);if(void 0!==o)return Array.isArray(o)?o.forEach((e=>{n.appendChild(e)})):"string"==typeof o?n.textContent=o:n.appendChild(o),n},t=function(){const e=document.getElementById("createDbBtn");e.textContent="Creating...";const t=JSON.parse(localStorage.getItem("user"));fetch("http://localhost:3000/api/createDB",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t.access_token}}).then((()=>{e.textContent="Database is created!!"}))},o=function(){const o=e("btn",{class:"createDb",id:"createDbBtn"},"loading"),n=document.getElementById("createDb");return o.addEventListener("click",t),{render:()=>{n.appendChild(o)},dbBtn:o}},n=function(){document.getElementById("login").textContent="Connecting...",chrome.identity.launchWebAuthFlow({url:"https://api.notion.com/v1/oauth/authorize?client_id=886c4ba1-a766-4abe-b227-68d823f578eb&response_type=code&owner=user&redirect_uri=https%3A%2F%2Flgfogmkjmheekcelnijmlmbojdbaoabh.chromiumapp.org%2F",interactive:!0},(function(e){if(chrome.runtime.lastError||!e)return void console.error(chrome.runtime.lastError);console.log(e);const t=function(e){const t=new URL(e);return{code:t.searchParams.get("code"),error:t.searchParams.get("error")}}(e);console.log("dd"),t.code,localStorage.setItem("redirectUrlCode",JSON.stringify(t)),console.log("token letsift")}));const e=JSON.parse(localStorage.getItem("user"));e&&setTimeout((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{accessToken:e.access_token})}))}),500)},r=function(){const t=e("button",{id:"login",class:"createDb"},"Connect to notion"),o=document.getElementById("connect");return t.addEventListener("click",n),{render:function(){o.appendChild(t)},loginBtn:t}};window.onload=()=>{const e=document.getElementById("createDbBtn"),t=JSON.parse(localStorage.getItem("user"));console.log(t),t&&(fetch("http://localhost:3000/api/dbId",{method:"GET",headers:{"Content-Type":"application/json",Authorization:t.access_token}}).then((e=>e.json())).then((t=>{console.log(t.dbId.length),t.error||0===t.dbId.length?e.textContent="Create Notion Database":(e.textContent="database is created",e.style.opacity="0.8",e.disabled=!0)})),setTimeout((()=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{accessToken:t.access_token})}))}),500))},document.addEventListener("DOMContentLoaded",(()=>{const t=r;o().render(),r(),o();const n=document.getElementById("createDbBtn"),a=JSON.parse(localStorage.getItem("redirectUrlCode")),c="undefined"!==localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):void 0;!c&&a&&fetch(`http://localhost:3000/api/auth?code=${a.code}&error=${a.error}`).then((e=>e.json())).then((o=>{console.log("data",o.data),fetch("http://localhost:3000/api/dbId",{method:"GET",headers:{"Content-Type":"application/json",Authorization:o.data.access_token}}).then((e=>e.json())).then((e=>{console.log(e.dbId.length),e.error||0===e.dbId.length?n.textContent="Create Notion Database":(n.textContent="database is created",n.style.opacity="0.8",n.disabled=!0)})),localStorage.setItem("user",JSON.stringify(o.data)),t().loginBtn.parentElement.removeChild(t);const r=e("p",{style:"color:#37352f;font-size:17px;text-align:center;font-weight:bold;margin-top:.5rem;"},o.data.owner.user.name),a=e("img",{style:"object-fit:cover;border-radius:50%;width:100%;display:block;",src:o.data.owner.user.avatar_url,alt:o.data.owner.user.name},""),c=e("div",{style:"border-radius:50%; margin-inline:auto; width:100px; margin-top:1rem;"},a),s=document.getElementById("parent");if(s.appendChild(c),s.appendChild(r),n.style.display="block",o.error)return console.log("error")}));const s=JSON.parse(localStorage.getItem("user"));if(console.log("isLogged",s),null===s&&t().render(),c||(n.style.display="none"),c){const t=e("p",{style:"color:#37352f;font-size:17px;text-align:center;font-weight:bold;margin-top:.5rem;"},c.owner.user.name),o=e("img",{style:"object-fit:cover;border-radius:50%;width:100%;display:block;",src:c.owner.user.avatar_url,alt:c.owner.user.name},""),n=e("div",{style:"border-radius:50%; margin-inline:auto; width:100px; margin-top:1rem;"},o),r=document.getElementById("parent");r.appendChild(n),r.appendChild(t)}}))})();