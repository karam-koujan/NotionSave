(()=>{"use strict";const t="http://localhost:3000",e=function(e,{onError:n,onSuccess:o}){const a=localStorage.getItem("token"),i={databaseId:localStorage.getItem("databaseId"),...e};fetch(`${t}/api/bookmark`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:JSON.stringify(i)}).then((t=>t.json())).then((({object:t})=>{if("error"===t)return n();o()})).catch((()=>n()))},n=function(t,e,n){const o=document.createElement(t);if(null!==e)for(let t in e)o.setAttribute(t,e[t]);if(void 0!==n)return Array.isArray(n)?n.forEach((t=>{o.appendChild(t)})):"string"==typeof n?o.textContent=n:o.appendChild(n),o},o=function t(e,n,o=!1){const a=o?document.querySelectorAll(e):document.querySelector(e);a?n(a):setTimeout((()=>{t(e,n)}),100)},a=function(t,{content:e,loading:n,success:o,error:a}){return i=>{"default"===i&&(t.textContent=e),"loading"===i&&(t.textContent=n||"loading..."),"success"===i&&(t.textContent=o?n:"saved"),"error"===i&&(t.textContent=a?n:"error")}},i=function(t){let e=0;const n=setInterval((()=>{console.log("interval"),o("[data-adclicklocation='fl_unknown']",(e=>{for(let n of e)n.insertAdjacentElement("beforeend",t)}),!0),2===e&&clearInterval(n),e++}),500)},r=function(){const{ui:t,setState:o}=function({content:t,loading:e,success:o,error:i}){const r=n("span",{},t);return{ui:n("div",{style:"display:flex;justify-content:center;align-items:center; margin-inline:.6rem;cursor:pointer;"},r),setState:a(youtubeSaveBtnTxt,{content:t,loading:e,success:o,error:i})}}({content:"notion"});navigation.addEventListener("navigate",(e=>{e.hashChange||(o("default"),i(t))})),i(t),t.addEventListener("click",(()=>{const t=window.location.href;o("loading");const n=/\/([^/]+)\/$/.exec(t),a=n?n[1].replace(/_/g," "):"";e({link:t,type:"reddit",metaData:{title:a}},{onSuccess:()=>o("success"),onError:()=>o("error")})}))},s=function(t){console.log("time"),o("[data-testid='caret']",(e=>{e.addEventListener("click",(()=>{o("[data-testid='Dropdown']",(e=>{e.insertAdjacentElement("afterbegin",t)}))}))}))},c=function(){const{ui:t,setState:i}=function({content:t,loading:e,success:o,error:i}){const r=n("p",{style:"color:#e7e9ea;font-family:TwitterChirp;font-size:15px;font-weight:bold;padding:15px 0 12px 3rem;margin:0;"},t);return{ui:n("div",{id:"notion",style:"cursor:pointer"},r),setState:a(youtubeSaveBtnTxt,{content:t,loading:e,success:o,error:i})}}({content:"save to notion"});let r="";navigation.addEventListener("navigate",(e=>{if(!e.hashChange){i("default");const e=setInterval((()=>{s(t),clearInterval(e)}))}})),s(t),t.addEventListener("click",(()=>{o("[data-testid='tweetText']",(t=>{r=t.firstChild.textContent,r=r.length<10?r:r.slice(0,10)}));const t=window.location.href;i("loading"),e({link:t,type:"twitter",metaData:{title:r}},{onError:()=>i("error"),onSuccess:()=>i("success")})}))};function l(t,e){o(t,(t=>{const n=t.firstElementChild;for(const t of n.children)"H1"===t.tagName&&e(t.textContent)}))}const d=function(){const{ui:t,setState:i}=function({content:t,loading:e,success:o,error:i}){const r=n("span",{style:"color:#0f0f0f;font-size:14px;font-family:Roboto,Arial,sans-serif;font-weight:bold;text-transform:capitalize;"},t);return{ui:n("div",{style:"display:flex;justify-content:center;align-item:center;padding:10px 16px;cursor:pointer; background:white;border-radius:18px;margin-right:.9rem;transition:opacity 0.6 ease-in;",onmouseover:"this.style.opacity=0.9",onmouseout:"this.style.opacity=1"},r),setState:a(r,{content:t,loading:e,success:o,error:i})}}({content:"notion"});let r;(function(t){o("#actions",(e=>{e.insertAdjacentElement("afterbegin",t)}))})(t),navigation.addEventListener("navigate",(t=>{t.hashChange||(i("default"),console.log("change",r),l("#above-the-fold",(t=>{console.log(t),r=t})))})),r||l("#above-the-fold",(t=>{r=t})),t.addEventListener("click",(()=>{const t=window.location.href;i("loading"),e({link:t,type:"youtube",metaData:{title:r}},{onSuccess:()=>i("success"),onError:()=>i("error")})}))};let u=!1;const f=localStorage.getItem("token"),g=localStorage.getItem("databaseId");f&&g&&(u=!0,-1!==location.hostname.indexOf("youtube")&&(console.log("youtube...."),d()),-1!==location.hostname.indexOf("twitter")&&c(),-1!==location.hostname.indexOf("reddit")&&(console.log("working!!!"),r())),chrome.runtime.onMessage.addListener((function(t,e,n){if(t.accessToken){const e=t.accessToken;localStorage.setItem("token",e)}if(t.databaseId){const e=t.databaseId;localStorage.setItem("databaseId",e)}const o=localStorage.getItem("token"),a=localStorage.getItem("databaseId");o&&a&&!u&&(u=!0,-1!==location.hostname.indexOf("youtube")&&(console.log("youtube...."),d()),-1!==location.hostname.indexOf("twitter")&&c(),-1!==location.hostname.indexOf("reddit")&&(console.log("working!!!"),r()))}))})();